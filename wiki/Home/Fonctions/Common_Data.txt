Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2015-09-06T12:55:44+02:00

====== Common Data ======

Les Common Data sont des informations stockées sous forme de paires clé-valeur, accessible depuis n'importe quel script.
Elles sont particulièrement importantes pour la communication entre les différents scripts.

De base, les common Data sont stockées dans une zone temporaire créée au lancement du jeu (appelée //default common data area// en anglais, elle se nomme "") ou dans une zone temporaire dédiée (dont le nom est défini par l'utilisateur) et disparaissent à la fin de l'exécution du jeu.
Pour conserver les Common Data d'une partie à l'autre, on peut les définir dans une zone dédiée associée à un fichier (.txt ou .dat) et sauvegarder ces données dans le fichier.

//Se référer au tutoriel de Sparen pour quelques spécificités des Common Data (cas des Single contenant des Boss Scenes et des Replay).//

== Manipulation de Common Data dans la zone temporaire "" ==
[[+SetCommonData]] 
[[+GetCommonData]] 
[[+ClearCommonData]] 
[[+DeleteCommonData]] 

== Manipulation de zones dédiées ==
[[+GetCommonDataAreaKeyList]] 
[[+CreateCommonDataArea]] 
[[+IsCommonDataAreaExists]] 
[[+CopyCommonDataArea]] 
[[+SaveCommonDataAreaToReplayFile]] 
[[+LoadCommonDataAreaFromReplayFile]] 

== Manipulation de Common Data dans les zones dédiées ==
[[+GetCommonDataValueKeyList]] 
[[+SetAreaCommonData]] 
[[+GetAreaCommonData]] 
[[+ClearAreaCommonData]] 
[[+DeleteAreaCommonData]] 
[[+SaveCommonDataAreaA1]] (sauvegarde dans un dossier data géré par le logiciel)
[[+LoadCommonDataAreaA1]] (récupération dans un dossier data géré par le logiciel)
[[+SaveCommonDataAreaA2]] (sauvegarde dans un fichier défini par l'utilisateur)
[[+LoadCommonDataAreaA2]] (récupération depuis un fichier défini par l'utilisateur)

== Exemple : ==
On souhaite créer un stage Extra disponible uniquement lorsque le joueur aura fini le jeu en mode normal.
On va créer une petit fichier de sauvegarde ''save.dat'' contenant la clé ''"EXTRA"'' et la valeur ''"false"'' si le joueur n'a pas encore fini le jeu en mode normal, ''"true"'' sinon.
La variable ''path'' correspond au chemin d'acces de notre fichier ''save.dat''.

Au lancement du package, on va créer une zone réservée appelée ''"SAVE"'' :
'''
if(!IsCommonDataAreaExists("SAVE")) { 
'''
	'''
	CreateCommonDataArea("SAVE"); 
	}
	'''


Si le fichier n'existe pas encore (cas de première utilisation du jeu), on va en créer un par défaut, où le stage Extra n'est pas débloqué.
'''
if (!LoadCommonDataAreaA2("SAVE",path)) {
'''
	'''
	SetAreaCommonData("SAVE","EXTRA","false");
	SaveCommonDataAreaA2("SAVE",path);
	}
	'''


Avant d'afficher le menu, on va vérifier si on affiche une  entrée pour le stage Extra :
'''
let extra_available;
alternative(GetAreaCommonData("SAVE","EXTRA","false"))
case ("false") { extra_available = false; }
case ("true")  { extra_available = true; }
'''


Supposons que notre joueur n'avait pas encore débloqué le stage Extra et qu'il parvienne à finir le jeu en mode normal.
Avant qu'il quitte le jeu, on va enregistrer sa performance :
'''
SetAreaCommonData("SAVE","EXTRA","true");
SaveCommonDataAreaA2("SAVE",path);
'''


De la sorte, au prochain lancement du jeu, le menu affichera une entrée supplémentaire pour lancer le stage Extra.
